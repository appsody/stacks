language: generic

go:
  - 1.12.x

os: linux
dist: bionic

services:
  - docker

# Delete git repo setup from travis
# and replace with git clone to master.
# reset hard to $TRAVIS_COMMIT
install:
  - . ./ci/git_setup.sh
  - mkdir ${TRAVIS_BUILD_DIR}/jars
  - wget -nv https://repo1.maven.org/maven2/org/osgi/org.osgi.core/6.0.0/org.osgi.core-6.0.0.jar -O ${TRAVIS_BUILD_DIR}/jars/osgi.jar

before_script:
  - ./ci/download_cli.sh

script:
  - . ./ci/build.sh

# note before_deploy will run before each deploy provider
before_deploy:
  - . ./ci/release.sh

deploy:
  provider: releases
  skip_cleanup: true
  api_key: $GITHUB_TOKEN
  file: ci/release/*
  file_glob: true
  on:
    tags: true
    repo: appsody/stacks
    branch: master
